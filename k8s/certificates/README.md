TODO in another PR this one is already huge
